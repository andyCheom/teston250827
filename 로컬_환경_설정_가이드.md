# ğŸ“‹ GraphRAG ë¡œì»¬ í™˜ê²½ ì„¤ì • ê°€ì´ë“œ

GraphRAG í”„ë¡œì íŠ¸ë¥¼ ë¡œì»¬ í™˜ê²½ì—ì„œ ì‹¤í–‰í•˜ê¸° ìœ„í•œ í™˜ê²½ ì„¤ì • ê°€ì´ë“œì…ë‹ˆë‹¤.

## ğŸ“¦ ì‹œìŠ¤í…œ ìš”êµ¬ì‚¬í•­

### í•„ìˆ˜ ì†Œí”„íŠ¸ì›¨ì–´
- **Python 3.11+** (Python íŒ¨í‚¤ì§€ ì‹¤í–‰ìš©)
- **pip** (Python íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
- **Node.js 18+** (Firebase CLI ì„¤ì¹˜ìš©)
- **npm** (Node.js íŒ¨í‚¤ì§€ ê´€ë¦¬ì)
- **Git** (ì½”ë“œ ì €ì¥ì†Œ ë³µì œìš©)

### ì„ íƒì‚¬í•­
- **Docker** (ì»¨í…Œì´ë„ˆ í™˜ê²½ í…ŒìŠ¤íŠ¸ìš©)
- **Google Cloud SDK (gcloud CLI)** (Cloud ì„œë¹„ìŠ¤ ê´€ë¦¬ìš©)

## ğŸ› ï¸ ì„¤ì¹˜ ë‹¨ê³„

### 1. í”„ë¡œì íŠ¸ ë³µì œ ë° ë””ë ‰í† ë¦¬ ì´ë™

```bash
git clone <REPOSITORY_URL>
cd graphrag
```

### 2. Python ê°€ìƒí™˜ê²½ ì„¤ì •

```bash
# ê°€ìƒí™˜ê²½ ìƒì„±
python3 -m venv venv

# ê°€ìƒí™˜ê²½ í™œì„±í™”
# Linux/macOS:
source venv/bin/activate

# Windows:
venv\Scripts\activate
```

### 3. Python ì˜ì¡´ì„± ì„¤ì¹˜

```bash
# requirements.txtì— ëª…ì‹œëœ íŒ¨í‚¤ì§€ ì„¤ì¹˜
pip install -r requirements.txt
```

#### ì£¼ìš” Python íŒ¨í‚¤ì§€
- **FastAPI**: ì›¹ API í”„ë ˆì„ì›Œí¬
- **Uvicorn/Gunicorn**: ASGI ì„œë²„
- **Google Cloud ë¼ì´ë¸ŒëŸ¬ë¦¬**: GCP ì„œë¹„ìŠ¤ ì—°ë™
  - `google-cloud-storage`
  - `google-cloud-spanner`
  - `google-auth`
  - `google-api-python-client`
- **ê¸°íƒ€ ìœ í‹¸ë¦¬í‹°**: 
  - `requests`, `aiohttp` (HTTP í´ë¼ì´ì–¸íŠ¸)
  - `python-dotenv` (í™˜ê²½ë³€ìˆ˜ ê´€ë¦¬)
  - `python-multipart` (íŒŒì¼ ì—…ë¡œë“œ)
  - `soynlp` (í•œêµ­ì–´ ì²˜ë¦¬)

### 4. Firebase CLI ì„¤ì¹˜ (ì„ íƒì‚¬í•­)

```bash
# Firebase CLI ì „ì—­ ì„¤ì¹˜
npm install -g firebase-tools

# Google ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
firebase login
```

## ğŸ”‘ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

### í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜

í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— `.env` íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜ ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ë¡œ ì„¤ì •:

```bash
# Google Cloud í”„ë¡œì íŠ¸ ì„¤ì •
PROJECT_ID=your-gcp-project-id
LOCATION_ID=us-central1
MODEL_ID=gemini-2.5-flash

# Vertex AI Search (Discovery Engine) ì„¤ì •
DATASTORE_ID=your-datastore-id
DATASTORE_LOCATION=global

# Discovery Engine ì„¸ë¶€ ì„¤ì •
DISCOVERY_LOCATION=global
DISCOVERY_COLLECTION=default_collection
DISCOVERY_ENGINE_ID=test_1753406039510
DISCOVERY_SERVING_CONFIG=default_search

# Spanner ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì •
SPANNER_INSTANCE_ID=your-spanner-instance
SPANNER_DATABASE_ID=your-spanner-database
SPANNER_TABLE_NAME=Triple

# íŒŒì¼ ê²½ë¡œ ì„¤ì •
SYSTEM_PROMPT_PATH=prompt/prompt.txt
SERVICE_ACCOUNT_PATH=keys/your-service-account-key.json
STOPWORDS_PATH=stopwords.txt

# ì„œë²„ ì„¤ì •
API_PORT=8000
STATIC_FILES_DIR=public

# CORS ì„¤ì • (ì‰¼í‘œë¡œ êµ¬ë¶„ëœ ë„ë©”ì¸ ëª©ë¡, * = ëª¨ë“  ë„ë©”ì¸)
CORS_ORIGINS=*

# OAuth ì„¤ì • (ì„ íƒì‚¬í•­)
OAUTH_CLIENT_ID=your-oauth-client-id.googleusercontent.com
OAUTH_CLIENT_SECRET=your-oauth-client-secret
OAUTH_REDIRECT_URI=http://localhost:8080/oauth/callback

# ë¡œê¹… ì„¤ì •
LOG_LEVEL=INFO
LOG_DIR=logs

# HTTP íƒ€ì„ì•„ì›ƒ ì„¤ì • (ì´ˆ)
HTTP_TIMEOUT_TOTAL=300
HTTP_TIMEOUT_CONNECT=10
HTTP_KEEPALIVE_TIMEOUT=30

# ì„œë²„ ì„±ëŠ¥ ì„¤ì •
GUNICORN_WORKERS=4
CLOUD_RUN_CONCURRENCY=80

# ì•± ì •ë³´
APP_NAME=GraphRAG Chatbot API
APP_VERSION=2.0.0
APP_DESCRIPTION=ëª¨ë“ˆí™”ëœ GraphRAG ê¸°ë°˜ ì±—ë´‡ API

# Secret Manager ì‚¬ìš© ì—¬ë¶€ (í´ë¼ìš°ë“œ ë°°í¬ì‹œ)
USE_SECRET_MANAGER=False
```

### í™˜ê²½ ë³€ìˆ˜ ì„¤ì • ë°©ë²•

#### ì˜µì…˜ 1: .env íŒŒì¼ ì‚¬ìš©
```bash
# í”„ë¡œì íŠ¸ ë£¨íŠ¸ì— .env íŒŒì¼ ìƒì„±
touch .env
# ìœ„ì˜ í™˜ê²½ ë³€ìˆ˜ë“¤ì„ .env íŒŒì¼ì— ì‘ì„±
```

#### ì˜µì…˜ 2: ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# Linux/macOS
export PROJECT_ID="your-gcp-project-id"
export LOCATION_ID="us-central1"
# ... ê¸°íƒ€ ë³€ìˆ˜ë“¤

# Windows (PowerShell)
$env:PROJECT_ID="your-gcp-project-id"
$env:LOCATION_ID="us-central1"
# ... ê¸°íƒ€ ë³€ìˆ˜ë“¤
```

## ğŸ” Google Cloud ì¸ì¦ ì„¤ì •

### 1. ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼ ì¤€ë¹„

1. Google Cloud Consoleì—ì„œ ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼(JSON) ë‹¤ìš´ë¡œë“œ
2. íŒŒì¼ì„ `keys/` ë””ë ‰í† ë¦¬ì— ë°°ì¹˜
3. `modules/config.py`ì—ì„œ `SERVICE_ACCOUNT_PATH` ê²½ë¡œ í™•ì¸

```python
# config.py ì˜ˆì‹œ
SERVICE_ACCOUNT_PATH = "keys/your-service-account-key.json"
```

### 2. í•„ìš”í•œ IAM ê¶Œí•œ

ì„œë¹„ìŠ¤ ê³„ì •ì— ë‹¤ìŒ ì—­í• ì„ ë¶€ì—¬í•´ì•¼ í•©ë‹ˆë‹¤:

- `roles/aiplatform.user` (Vertex AI ì‚¬ìš©)
- `roles/spanner.databaseUser` (Spanner ì½ê¸°)
- `roles/storage.objectViewer` (Cloud Storage ì ‘ê·¼)
- `roles/discoveryengine.admin` (Discovery Engine ì‚¬ìš©)

### 3. ë¡œì»¬ ê°œë°œìš© ì¸ì¦ (ëŒ€ì•ˆ)

```bash
# Google Cloud SDK ì„¤ì¹˜ í›„
gcloud auth application-default login
```

## ğŸ“ í•„ìˆ˜ íŒŒì¼ ë° ë””ë ‰í† ë¦¬ êµ¬ì¡°

```
graphrag/
â”œâ”€â”€ keys/                    # ğŸ”‘ ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼
â”‚   â””â”€â”€ your-key.json       # Google Cloud ì¸ì¦ìš©
â”œâ”€â”€ prompt/                 # ğŸ’¬ AI í”„ë¡¬í”„íŠ¸ íŒŒì¼
â”‚   â””â”€â”€ prompt.txt         # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
â”œâ”€â”€ stopwords.txt          # ğŸš« ë¶ˆìš©ì–´ ì‚¬ì „
â”œâ”€â”€ modules/               # ğŸ“¦ ì†ŒìŠ¤ ì½”ë“œ ëª¨ë“ˆ
â”œâ”€â”€ public/                # ğŸŒ ì •ì  ì›¹ íŒŒì¼
â”œâ”€â”€ .env                   # âš™ï¸ í™˜ê²½ ë³€ìˆ˜ (ìƒì„± í•„ìš”)
â”œâ”€â”€ requirements.txt       # ğŸ“‹ Python ì˜ì¡´ì„±
â””â”€â”€ main.py               # ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì§„ì…ì 
```

## ğŸš€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰

### ê°œë°œ ì„œë²„ ì‹¤í–‰

```bash
# FastAPI ê°œë°œ ì„œë²„ ì‹¤í–‰ (í•« ë¦¬ë¡œë“œ í™œì„±í™”)
uvicorn main:app --reload --port 8000

# ë˜ëŠ” Pythonìœ¼ë¡œ ì§ì ‘ ì‹¤í–‰
python main.py
```

### í”„ë¡œë•ì…˜ ì„œë²„ ì‹¤í–‰

```bash
# Gunicorn + Uvicorn worker ì¡°í•©
gunicorn -w 4 -k uvicorn.workers.UvicornWorker -b 0.0.0.0:8000 main:app
```

## ğŸŒ ì ‘ì† í™•ì¸

ì„œë²„ ì‹¤í–‰ í›„ ë¸Œë¼ìš°ì €ì—ì„œ í™•ì¸:

- **ì• í”Œë¦¬ì¼€ì´ì…˜**: http://localhost:8000
- **API ë¬¸ì„œ**: http://localhost:8000/docs (Swagger UI)
- **í—¬ìŠ¤ ì²´í¬**: http://localhost:8000/api/health

## ğŸ³ Dockerë¡œ ì‹¤í–‰ (ì„ íƒì‚¬í•­)

### Docker ì´ë¯¸ì§€ ë¹Œë“œ ë° ì‹¤í–‰

```bash
# Docker ì´ë¯¸ì§€ ë¹Œë“œ
docker build -t graphrag-app .

# ì»¨í…Œì´ë„ˆ ì‹¤í–‰ (í™˜ê²½ ë³€ìˆ˜ ì£¼ì…)
docker run -p 8000:8080 \
  -e PROJECT_ID=your-project \
  -e LOCATION_ID=us-central1 \
  -e MODEL_ID=gemini-2.5-flash \
  -e DATASTORE_ID=your-datastore \
  -e DATASTORE_LOCATION=global \
  -v $(pwd)/keys:/usr/src/app/keys:ro \
  graphrag-app
```

## âš ï¸ ë¬¸ì œ í•´ê²°

### ì¼ë°˜ì ì¸ ì˜¤ë¥˜ ë° í•´ê²°ì±…

#### 1. ì¸ì¦ ì˜¤ë¥˜
```
âŒ ì¸ì¦ ì´ˆê¸°í™” ì‹¤íŒ¨ - ì„œë¹„ìŠ¤ê°€ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
```
**í•´ê²°ì±…**: 
- ì„œë¹„ìŠ¤ ê³„ì • í‚¤ íŒŒì¼ ê²½ë¡œ í™•ì¸
- IAM ê¶Œí•œ í™•ì¸
- `gcloud auth application-default login` ì‹¤í–‰

#### 2. í™˜ê²½ ë³€ìˆ˜ ì˜¤ë¥˜
```
âŒ í™˜ê²½ë³€ìˆ˜ 'PROJECT_ID'ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.
```
**í•´ê²°ì±…**: 
- `.env` íŒŒì¼ ìƒì„± ë° í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
- ì‹œìŠ¤í…œ í™˜ê²½ ë³€ìˆ˜ í™•ì¸

#### 3. ì˜ì¡´ì„± ì„¤ì¹˜ ì˜¤ë¥˜
```
ERROR: Could not find a version that satisfies the requirement...
```
**í•´ê²°ì±…**: 
- Python ë²„ì „ í™•ì¸ (3.11+ í•„ìš”)
- pip ì—…ê·¸ë ˆì´ë“œ: `pip install --upgrade pip`
- ê°€ìƒí™˜ê²½ ì¬ìƒì„±

#### 4. í¬íŠ¸ ì¶©ëŒ
```
OSError: [Errno 98] Address already in use
```
**í•´ê²°ì±…**: 
- ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©: `uvicorn main:app --port 8001`
- ê¸°ì¡´ í”„ë¡œì„¸ìŠ¤ ì¢…ë£Œ: `lsof -ti:8000 | xargs kill -9`

### ë¡œê·¸ í™•ì¸

```bash
# ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸ í™•ì¸
tail -f logs/*.json

# ë˜ëŠ” ì‹¤ì‹œê°„ ë¡œê·¸ ì¶œë ¥ìœ¼ë¡œ ì‹¤í–‰
uvicorn main:app --reload --log-level debug
```

## ğŸ“š ì¶”ê°€ ë¦¬ì†ŒìŠ¤

- [FastAPI ê³µì‹ ë¬¸ì„œ](https://fastapi.tiangolo.com/)
- [Google Cloud Vertex AI ë¬¸ì„œ](https://cloud.google.com/vertex-ai/docs)
- [Google Cloud Spanner ë¬¸ì„œ](https://cloud.google.com/spanner/docs)
- [Firebase Hosting ë¬¸ì„œ](https://firebase.google.com/docs/hosting)

---

**ì°¸ê³ **: ì´ ê°€ì´ë“œëŠ” ë¡œì»¬ ê°œë°œ í™˜ê²½ ê¸°ì¤€ìœ¼ë¡œ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ ë°°í¬ëŠ” `cloudbuild.yaml` ë° `Dockerfile`ì„ ì°¸ì¡°í•˜ì„¸ìš”.